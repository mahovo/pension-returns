# `r headlines[i]`

```{r}
library(gridExtra)
```


## QQ Plot

Skewed $t$-distribution (sstd):  

```{r fig.height=3, fig.width=10}
if(long == FALSE) {
  par(mfrow = c(1, 3))
  (fits[[i]]$qqplot)()
  
  (fits_std[[i]]$qqplot)()
  
  (fits_norm[[i]]$qqplot)()
  par(mfrow = c(1, 1))
} else {
  par(mfrow = c(1, 3))
  (fits_l[[i]]$qqplot)()
  
  (fits_std_l[[i]]$qqplot)()
  
  (fits_norm_l[[i]]$qqplot)()
  par(mfrow = c(1, 1))
}
```



## Data vs fit

Let's plot the fit and the observed returns together.  

```{r fig.height=3, fig.width=10}
if(long == FALSE) {
  par(mfrow = c(1, 3))
  (fits[[i]]$fit_plot)()
  
  (fits_std[[i]]$fit_plot)()
  
  (fits_norm[[i]]$fit_plot)()
  par(mfrow = c(1, 1))
} else {
  par(mfrow = c(1, 3))
  (fits_l[[i]]$fit_plot)()
  
  (fits_std_l[[i]]$fit_plot)()
  
  (fits_norm_l[[i]]$fit_plot)()
  par(mfrow = c(1, 1))
}
```



## Estimated distribution

Now lets look at the CDF of the estimated distribution for each 0.1% increment between 0.5% and 99.5% for the estimated distribution:

```{r fig.height=8, fig.width=10}
if(long == FALSE) {
  par(mfrow = c(3, 3))
  (fits[[i]]$dist_plot)()
  
  (fits_std[[i]]$dist_plot)()
  
  (fits_norm[[i]]$dist_plot)()
  
  (fits[[i]]$quantile_plot)()
  
  (fits_std[[i]]$quantile_plot)()
  
  (fits_norm[[i]]$quantile_plot)()
  
  (fits[[i]]$dens_plot)()
  
  (fits_std[[i]]$dens_plot)()
  
  (fits_norm[[i]]$dens_plot)()
  par(mfrow = c(1, 1))
} else {
  par(mfrow = c(3, 3))
  (fits_l[[i]]$dist_plot)()
  
  (fits_std_l[[i]]$dist_plot)()
  
  (fits_norm_l[[i]]$dist_plot)()
  
  (fits_l[[i]]$quantile_plot)()
  
  (fits_std_l[[i]]$quantile_plot)()
  
  (fits_norm_l[[i]]$quantile_plot)()
  
  (fits_l[[i]]$dens_plot)()
  
  (fits_std_l[[i]]$dens_plot)()
  
  (fits_norm_l[[i]]$dens_plot)()
  par(mfrow = c(1, 1))
}
```



## Monte Carlo


```{r}
if(long == FALSE) {
  max_nu_test <- fund_names[i] == rank_summary(fit_summary[3, ], sorting = "hi")[1, 2] 
  
  min_nu_test <- fund_names[i] == rank_summary(fit_summary[3, ], sorting = "hi")[length(fund_names), 2] 
  
  nu_test <- max_nu_test + min_nu_test
} else {
  max_nu_test <- FALSE
  min_nu_test <- FALSE
  nu_test <- FALSE
}
```



`r if(max_nu_test) {paste0(fund_names[i], " has the sstd fit with the highest sstd fit with thevalue of nu. Compare with other distributions:")}`

`r if(min_nu_test) {paste0(fund_names[i], " has the sstd fit with the lowest value of nu. Compare with other distributions:")}`



```{r results='hide',fig.keep='all', eval=params$run_mc_plot, fig.height=6, fig.width=8}

## Plot only for funds with smallest and biggest value of nu

if(nu_test) {
  (mc_output[[i]]$mc_plot)()
}
```

```{r results='hide',fig.keep='all', eval=params$run_mc_plot, fig.height=6, fig.width=8}

## Plot only for funds with smallest and biggest value of nu

if(nu_test) {
  (mc_output_std[[i]]$mc_plot)()
}
```

```{r results='hide',fig.keep='all', eval=params$run_mc_plot, fig.height=6, fig.width=8}

## Plot only for funds with smallest and biggest value of nu

if(nu_test) {
  (mc_output_norm[[i]]$mc_plot)()
}
```


Sorted portfolio index values for last period of all runs

```{r results='hide',fig.keep='all', fig.height=3, fig.width=10}
if(long == FALSE) {
  par(mfrow = c(1, 3))
  (mc_output[[i]]$mc_plot_last_period)()
  
  (mc_output_std[[i]]$mc_plot_last_period)()
  
  (mc_output_norm[[i]]$mc_plot_last_period)()
  par(mfrow = c(1, 1))
} else {
  par(mfrow = c(1, 3))
  (mc_output_l[[i]]$mc_plot_last_period)()
  
  (mc_output_std_l[[i]]$mc_plot_last_period)()
  
  (mc_output_norm_l[[i]]$mc_plot_last_period)()
  par(mfrow = c(1, 1))
}
```


## Convergence

### Max vs sum

Max vs sum plots for the first four moments:

```{r fig.height=8, fig.width=10}
if(long == FALSE) {
  grid.arrange(
    arrangeGrob(
      max_sum_plots[[i]][[1]], 
      max_sum_plots[[i]][[2]], 
      max_sum_plots[[i]][[3]], 
      max_sum_plots[[i]][[4]],
      top = "sstd",
      nrow = 4
    ), 
    arrangeGrob(
      max_sum_plots_std[[i]][[1]], 
      max_sum_plots_std[[i]][[2]], 
      max_sum_plots_std[[i]][[3]], 
      max_sum_plots_std[[i]][[4]],
      top = "std",
      nrow = 4
    ),
    arrangeGrob(
      max_sum_plots_norm[[i]][[1]], 
      max_sum_plots_norm[[i]][[2]], 
      max_sum_plots_norm[[i]][[3]], 
      max_sum_plots_norm[[i]][[4]],
      top = "normal",
      nrow = 4
    ),
    ncol = 3
  )
} else {
  grid.arrange(
    arrangeGrob(
      max_sum_plots_l[[i]][[1]], 
      max_sum_plots_l[[i]][[2]], 
      max_sum_plots_l[[i]][[3]], 
      max_sum_plots_l[[i]][[4]],
      top = "sstd",
      nrow = 4
    ), 
    arrangeGrob(
      max_sum_plots_std_l[[i]][[1]], 
      max_sum_plots_std_l[[i]][[2]], 
      max_sum_plots_std_l[[i]][[3]], 
      max_sum_plots_std_l[[i]][[4]],
      top = "std",
      nrow = 4
    ),
    arrangeGrob(
      max_sum_plots_norm_l[[i]][[1]], 
      max_sum_plots_norm_l[[i]][[2]], 
      max_sum_plots_norm_l[[i]][[3]], 
      max_sum_plots_norm_l[[i]][[4]],
      top = "normal",
      nrow = 4
    ),
    ncol = 3
  )
}
```




### MC

```{r fig.height=3, fig.width=10}
if(long == FALSE) {
  grid.arrange(
    arrangeGrob(
      mc_output[[i]]$mc_conv_plot(),
      top = "sstd",
      nrow = 1
    ),
    arrangeGrob(
      mc_output_std[[i]]$mc_conv_plot(),
      top = "std",
      nrow = 1
    ),
    arrangeGrob(
      mc_output_norm[[i]]$mc_conv_plot(),
      top = "normal",
      nrow = 1
    ),
    ncol = 3
  )
} else {
  grid.arrange(
    arrangeGrob(
      mc_output_l[[i]]$mc_conv_plot(),
      top = "sstd",
      nrow = 1
    ),
    arrangeGrob(
      mc_output_std_l[[i]]$mc_conv_plot(),
      top = "std",
      nrow = 1
    ),
    arrangeGrob(
      mc_output_norm_l[[i]]$mc_conv_plot(),
      top = "normal",
      nrow = 1
    ),
    ncol = 3
  )
}
```


### IS

Skewed $t$-distribution with a normal proposal distribution.

```{r fig.height=4, fig.width=5, eval=(params$run_is_plot)}
is_output[[i]]$is_plot()
```

Parameters

```{r fig.height=3, fig.width=4}
is_g_fits[[i]]$par
```

Objective function plots

```{r fig.height=4, fig.width=10, eval=params$run_is_plot}
grid.arrange(
  is_g_fits[[i]]$mean_vect_plot(),
  is_g_fits[[i]]$sd_vect_plot(),
  ncol = 2
)
```




